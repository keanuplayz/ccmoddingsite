<!DOCTYPE html>
	<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="main.css">
		<title>CCModding</title>

		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
		<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
		<script src="./mustache.min.js"></script>
	</head>
	<body>
		<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
			<header class="mdl-layout__header">
				<div class="mdl-layout__header-row">
				<span class="mdl-layout-title">Title</span>
				<div class="mdl-layout-spacer"></div>
				<nav class="mdl-navigation mdl-layout--large-screen-only">
					<a class="mdl-navigation__link" href="">News</a>
					<a class="mdl-navigation__link" href="">Link</a>
					<a class="mdl-navigation__link" href="">Link</a>
					<a class="mdl-navigation__link" href="">Link</a>
				</nav>
				</div>
			</header>
			<div class="mdl-layout__drawer">
				<span class="mdl-layout-title">Title</span>
				<nav class="mdl-navigation">
				<a class="mdl-navigation__link" href="">News</a>
				<a class="mdl-navigation__link" href="">Link</a>
				<a class="mdl-navigation__link" href="">Link</a>
				<a class="mdl-navigation__link" href="">Link</a>
				</nav>
			</div>
			<main class="mdl-layout__content">
				<div class="mdl-grid">
				<div class="mdl-layout-spacer"></div>
				<div class="mdl-cell mdl-cell--8-col">
					<h2>Current available mods:</h2>
					<ul class="mdl-list">
					</ul>
				</div>
				<div class="mdl-layout-spacer"></div>
				</div>
			</main>
			<script>
				// a life saver https://stackoverflow.com/a/7394787/3552401
				function decodeHtml(html) {
					var txt = document.createElement("textarea");
					txt.innerHTML = html;
					return txt.value;
				}
				window.onload = async () => {
					const data = await (await fetch('https://raw.githubusercontent.com/CCDirectLink/CCModDB/master/mods.json', {cache: "force-cache"})).json();
					// because the template system can't work with objects
					data.mods = Object.values(data.mods);
					const modTemplate = `
						{{#mods}}
							<li class="mdl-list__item mdl-list__item--two-line">
								<span class="mdl-list__item-primary-content">
									<i class="material-icons mdl-list__item-icon">chevron_right</i>
									<span>{{name}}</span>
									<span class="mdl-list__item-sub-title">{{name}}</span>
								</span>
								<span class="mdl-list__item-secondary-content">
									<span class="mdl-list__item-secondary-info"><a href="{{archive_link}}">Download</a></span>
									{{#page}}
										<a class="mdl-list__item-secondary-action center" href="{{url}}">{{name}}</a>
									{{/page}}
								</span>
							</li>
						{{/mods}}
					`;
					let html = Mustache.to_html(modTemplate, data).replace(/^\s*/mg, '');

					// the template engine converts some stuff to 
					// special html codes. Need to reverse it.
					html = decodeHtml(html);

					
					document.querySelector('.mdl-list').innerHTML = html;
				};
			</script>
		</div>
	</body>
</html>
